{% extends "layouts/base.html" %}

{% block main %}
{% set posts_section = get_section(path="posts/_index.md") %}
{% set yearly_posts = posts_section.pages | group_by(attribute="year") %}
{% for year, posts in yearly_posts %}
<div class="archive-year">
  <h2 class="text-2xl font-bold">{{ year }}<sup class="text-sm text-gray-500">&nbsp;&nbsp;{{ posts | length }}</sup></h2>
  {% set monthly_posts = posts | group_by(attribute="month") %}
  {% for month, posts in monthly_posts %}
  {% set month_name = posts[0].date | date(format="%B") %}
  <div class="flex p-4">
    <h3 class="text-xl font-bold w-[200px]">{{ month_name }}<sup class="text-sm text-gray-500">&nbsp;&nbsp;{{ posts | length }}</sup>
    </h3>
    <div class="archive-posts">
      {% for post in posts %}
      {% set formatted_date_long = post.date | date(format="%Y-%m-%d %H:%M:%S %z") %}
      {% set formatted_date_short = post.date | date(format="%Y-%m-%d") %}
      <div class="flex flex-col gap-1 p-2 relative">
        <h3>{{ post.title }}</h3>
        <div class="text-xs text-gray-400"><span title="{{ formatted_date_long }}">{{ formatted_date_short
            }}</span>&nbsp;·&nbsp;{{ post.reading_time }} min&nbsp;·&nbsp;{{ post.author | default(value=config.author)
          }}</div>
        <a class="absolute top-0 left-0 size-full nav-btn" aria-label="post link to {{ post.title }}" href="{{ post.permalink }}"></a>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endfor %}
</div>
{% endfor %}
{% endblock main %}